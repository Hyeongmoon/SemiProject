<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8" %>
<%@ page import="java.util.ArrayList, com.fh.freeBoard.model.vo.FreeBoardFile, com.fh.freeBoard.model.vo.FreeBoard" %>
    
    
<%
	FreeBoard f = (FreeBoard)request.getAttribute("f");
	ArrayList<FreeBoardFile> files = (ArrayList<FreeBoardFile>)request.getAttribute("files");
	
	FreeBoard prevF = (FreeBoard)request.getAttribute("prevF");
	FreeBoard nextF = (FreeBoard)request.getAttribute("nextF");
	
	
	
	int currentPage = (Integer)request.getAttribute("currentPage");


	
	
	//Ï†ïÎ†¨
	String sorting = "desc";
	if((String)request.getAttribute("sorting")!=null){
		
		sorting = (String)request.getAttribute("sorting");
		/* System.out.println("Ïã§ÌñâÎêòÎÇò ?"); */
	}
	
	
	//Í≤ÄÏÉâÏñ¥ 
	String searchOption = "";
	if((String)request.getAttribute("searchOption")!=null){
		searchOption = (String)request.getAttribute("searchOption");
	}
	
		
	//Í≤ÄÏÉâÌÉÄÏûÖ
	String inputValue = "";
	if((String)request.getAttribute("inputValue")!=null){
		
		inputValue = (String)request.getAttribute("inputValue");
	}
	
	
	String detailPath = request.getContextPath() + "/detail.free?currentPage=" + currentPage + "&sorting=" + 
							sorting + "&searchOption=" + searchOption + "&inputValue=" + inputValue;
	
	//ÏµúÏã†Ïàú(Í∏∞Î≥∏)/Ïò§ÎûòÎêúÏàúÏúºÎ°ú Ï°∞ÌöåÌïòÍ∏∞
 %>    
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<style>

    /* Ï†ÑÏ≤¥ÏòÅÏó≠ */
    .container-fluid>div>div{
        /* border: 1px solid red; */
    }
    .container-fluid>div>div>div{
        /* border: 1px solid blue; */
    }
    .container-fluid>div>div>div>div{
        /* border: 1px solid green; */
    }



    .container-fluid{ /* Ï†ÑÏ≤¥Ïû• ÌÅ¨Í∏∞*/
		
        max-width:1100px;
        margin:auto;
        margin-top: 50px;
        padding:20px;
        
    }
 
    

    /* =========================================== */
    /* Ï†úÎ™©ÏòÅÏó≠ */
    .detail-head {
        /* display: flex; */
        /* justify-content: space-between; */ /* Ï¢åÏ∏°Í≥º Ïö∞Ï∏° Ï†ïÎ†¨ */
        /* align-items: center; */ /* ÏÑ∏Î°ú Î∞©Ìñ•ÏúºÎ°ú Í∞ÄÏö¥Îç∞ Ï†ïÎ†¨ */   
    }


    .detail-head { /* Ï†úÎ™©, Í∏ÄÏì¥Ïù¥,Ï°∞ÌöåÏàò,ÎÇ†Ïßú ÌïúÏ§ÑÎ°ú Ï†ïÎ†¨*/
        /* display: flex; */
        width: 100%; /* Ï†ÑÏ≤¥ ÎÑàÎπÑ ÏÇ¨Ïö© */
    }
    .detail-title {
        flex-grow: 1; /* Í≥µÍ∞ÑÏùÑ Ï∞®ÏßÄÌïòÎèÑÎ°ù ÏÑ§Ï†ï */
    }
    .writer-area {
       /*  text-align: right; */ /* ÎÇ¥Î∂Ä ÌÖçÏä§Ìä∏ Ïò§Î•∏Ï™Ω Ï†ïÎ†¨ */
    }

    .writer-area {
      /*   padding-top: 20px; */ /* ÏõêÌïòÎäî ÎßåÌÅº ÏúÑÏ™ΩÏóê Í≥µÍ∞Ñ Ï∂îÍ∞Ä */
    	padding-left: 20px; 
    	color : gray;
    }


     /* =========================================== */
    /* Í≤åÏãúÍ∏Ä ÏòÅÏó≠ */
    .detail-content{  /* Í≤åÏãúÍ∏Ä ÎÇ¥Ïö© ÏòÅÏó≠ ÏúÑÏïÑÎûò ÏÑ†*/
        border:none;
        border-top: 4px solid black;
        border-bottom: 4px solid black;
        margin : auto;        
    }

  
    .detail-content>div{   /*Í≤åÏãúÍ∏ÄÎÇ¥Ïö© ÏúÑ,ÏïÑÎûò Í∞ÑÍ≤© */
         margin-top : 30px; 
    }

    .detail-content img{
        width:60%;
    }

	#pre-area{
		font-size:25px;
		white-space: pre-wrap;
		word-wrap: break-word; /* Îã®Ïñ¥ Îã®ÏúÑÎ°ú Ï§ÑÎ∞îÍøà */
		font-weight: 600;
	}
	
	#img-div img{
        margin-left: 20px; /* Ïù¥ÎØ∏ÏßÄ ÏÇ¨Ïù¥ Í∞ÑÍ≤© */
	}

    /* =========================================== */
    /* ÎåìÍ∏ÄÏòÅÏó≠ */
    .comment-area,/*ÎåìÍ∏ÄÎ∂ÄÎ∂Ñ ÏúÑ Í≥µÎ∞±*/
    .insert-comment,/*ÎåÅÍ∏ÄÏûÖÎ†•Ï∞Ω ÏúÑ Í≥µÎ∞±*/
    .page-area, /*ÌéòÏù¥ÏßïÎ∞îÏúÑ Í≥µÎ∞±*/
    .button-area {/* Î≤ÑÌäºÎì§ ÏúÑ Í≥µÎ∞±*/ 
        margin-top : 30px;
    }

    .comment-area,
    .insert-comment
    { /*ÎåìÍ∏Ä ÏòÅÏó≠ ÎÑàÎπÑ Ï°∞Ï†à*/
        width:95%;
        margin:auto;
        margin-top : 30px;
    }
    .comment-area>table {
        table-layout: fixed; /* ÌÖåÏù¥Î∏î Î†àÏù¥ÏïÑÏõÉ Í≥†Ï†ï */
        width: 100%; 
    }
    .comment-area>table td:nth-child(1){
        width:15%;
    }
    .comment-area>table td:nth-child(2){
        width:50%;
    }
    .comment-area>table td:nth-child(3){
        width:20%;
    }
    .comment-area>table td:nth-child(4){
        width:15%;
    }


    /* ÎåìÍ∏ÄÏûÖÎ†•Î∂ÄÎ∂Ñ */
    .insert-comment{
        max-width:100%;
        border: 2px solid black;
        text-align: left;
        margin:20px;
        padding: 10px;
        border-radius: 5px;
    }
    .comment-content>textarea,
    .insert-comment>input
    {
       border: none;
       width:100%;
    }
    .comment-content{
        display: flex;
        justify-content: center; 
        height: 90px;            /* Î∂ÄÎ™® ÎÜíÏù¥ ÏÑ§Ï†ï (ÌïÑÏöîÏãú ÎßûÍ≤å Î≥ÄÍ≤Ω) */
        border-bottom: 2px solid black; 
    }
    .comment-button{
        float: right;
    }
    .comment-bottom{
       
        

    }


    /* =========================================== */

    /* Ïù¥Ï†Ñ,Îã§Ïùå Í≤åÏãúÍ∏Ä ÏòÅÏó≠ */
    .page-area{ /* ÌéòÏù¥ÏßïÎ∞î ÏòÅÏó≠ ÏúÑÏïÑÎûò Íµ¨Î∂ÑÏÑ†*/
        border-top: 3px solid black;
        border-bottom : 3px solid black;
        
    
    }
    
    .page-area>table{
    
    	margin-top: 10; /* ÌïÑÏöîÏóê Îî∞Îùº Ï°∞Ï†ï */
		 margin-bottom: 0;  /* ÌïÑÏöîÏóê Îî∞Îùº Ï°∞Ï†ï */
    }
    .first-tr>td{ /* ÌéòÏù¥ÏßïÎ∞î ÏòÅÏó≠ Í∞ÄÏö¥Îç∞ Íµ¨Î∂ÑÏÑ†*/
        border-bottom: 1px solid black;
        
    }
    
   
    
    
	.hover-effect:hover {
	     cursor: pointer; 
	    
	 }
    



</style>    
</head>
<body>
    
    <%@include file="../common/navbar.jsp" %>
    
    <div class="container-fluid">
      
        <div id="board-deatil">

            <!-- ÏÉÅÎã® Ï†úÎ™©Î∂ÄÎ∂Ñ -->
            <div>
                <div>ÏûêÏú†Í≤åÏãúÌåê</div>
                <div class="detail-head">
                    <div class="detail-title">
                        <h1><%=f.getFreeTitle() %></h1>
                    </div>
                    
                    <div class="writer-area">
                        <span> <%=f.getUserNickName() %> </span> &nbsp;&nbsp;
                        <span> Ï°∞ÌöåÏàò:<%=f.getFreeCount() %> </span>&nbsp;&nbsp;
                        <span> <%=f.getFreeDate() %> </span>
                    </div>
                </div>
                
            </div>
            
            
            
            
            <!-- Ï§ëÍ∞Ñ Í≤åÏãúÍ∏ÄÎÇ¥Ïö©Î∂ÄÎ∂Ñ -->
            <div class="detail-content">
                <div>
					<pre id="pre-area"><%=f.getFreeContent() %></pre>                    

					<div id="img-div">
					
						<%if(!files.isEmpty()){ %>

							<% for(FreeBoardFile ff : files){ %>
								
			                    <img src="<%=contextPath%>/<%=ff.getFreeFilePath()+ff.getFreeFileRename()%>" alt="Ïù¥ÎØ∏ÏßÄ">
			                <%}%>    
						<%}%>
                    </div>
                </div>
                
                
                
                <!-- Ï¢ãÏïÑÏöî/ÎåìÍ∏Ä Î∂ÄÎ∂Ñ -->
                
                <div>
                    <span id="freeBoard-like">
                    	<span class="hover-effect" id="like-icon">&#x2764;&#xFE0F; &#x1F90D;</span>
						<span id="like-count"><%=f.getFreeLikeCount() %></span>
					</span>
                    <span id="freeBoard-comment">
                    	<span id="comment-icon"> &#x1F4AC; </span>
                    	<span id="comment-count"> <%=f.getFreeCommentCount() %> </span>
                    </span>
                </div>
            </div>
            
            
            
            
            
            
            
            
            <!-- ÎåìÍ∏ÄÎ∂ÄÎ∂Ñ -->
            
            <div class="comment-area">
                <table class="comment-table table  ">
                   
                    
                </table>    
            </div>

            


            <!-- ÎåìÍ∏Ä ÏûÖÎ†• Î∂ÄÎ∂Ñ -->


			<% if(loginUser==null){%>
			
            <div class="insert-comment">
                <input type="text" placeholder="Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§." disabled>
            </div>
            
			<% }else{ %>

            <div class="insert-comment" >
                
                <div class="coment-writer"><b><%=loginUser.getUserNickname() %></b></div>
                <div class="comment-content">
                    <textarea name="freeComment" id="free-comment" placeholder="ÎåìÍ∏ÄÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî" oninput="updateCount()" maxlength="300" style="resize: none"></textarea>
                </div>
                <div class="comment-bottom">
                    <div class="comment-button">
                    	
                    	<button class="btn btn-sm btn-info" onClick="inserComment()">Îì±Î°ù</button>
                    										
                    </div>
                    <div id="charCount">0/1000</div>
                </div>
                
            </div>
            
            
            <script>
            
            /* ÎåìÍ∏ÄÏ∞ΩÏóê Í∏ÄÏûêÏàò ÏïåÎ¶º/ ÏïåÎ¶ºÏ†úÌïú (ÏàúÏàò ÏûêÎ∞îÍµ¨Î¨∏ÏúºÎ°ú Ìï¥Î≥¥Í∏∞)*/
            
            	function updateCount(){
            		const textarea = document.getElementById("free-comment");
            		const charCount = document.getElementById("charCount");
            		const currentLength = textarea.value.length;
            		const maxLength = textarea.getAttribute("maxlength")
            		
            		charCount.innerHTML = currentLength+"/"+maxLength;
            	}
            
            
            </script>
            
            <% } %>
            
            <!-- Îã§ÏùåÍ∏Ä,Ïù¥Ï†ÑÍ∏Ä Î∂ÄÎ∂Ñ -->
            
            
            <div class="page-area">
                
                <table width="100%" class="table table-hover hover-effect">
                	
                	
                	<% if(prevF!=null){%>
	                    <tr onclick="location.href='<%=detailPath%>&freeNo=<%=prevF.getFreeNo()%>'">
	                    	
	                        <td>Ïù¥Ï†ÑÍ∏Ä</td>
	                        <td><%=prevF.getFreeNo() %></td>
	                        <td><%=prevF.getFreeTitle() %>  üí¨<%=prevF.getFreeCommentCount() %></td>
	                        <td><%=prevF.getUserNickName() %></td>
	                        <td><%=prevF.getFreeDate() %></td>
	                    </tr>
					<%}%>
					<%if(nextF != null){ %>
	                    <tr onclick="location.href='<%=detailPath%>&freeNo=<%=nextF.getFreeNo()%>'">
	                        <td>Îã§ÏùåÍ∏Ä</td>
	                        <td><%=nextF.getFreeNo() %></td>
	                        <td><%=nextF.getFreeTitle() %>  üí¨<%=nextF.getFreeCommentCount() %></td>
	                        <td><%=nextF.getUserNickName() %></td>
	                        <td><%=nextF.getFreeDate() %></td>
	                    </tr>
                    <%} %>
                </table>
            
            </div>
 
            
            
            
            <!-- ÏàòÏ†ï ÏÇ≠Ï†ú Î™©Î°ù Î≤ÑÌäº -->
            <div class="button-area">
                <div align="right">
                
                	
                	<%if(loginUser!=null && loginUser.getUserNo() == f.getUserNo()){ %>
                	
						<button onclick="updateForm()" class="btn btn-info">ÏàòÏ†ï</button>
						<button onclick="remove()" class="btn btn-danger">ÏÇ≠Ï†ú</button>
						
                	<%} %>
                
                    
                    
                    <%if(searchOption.equals("")){ %> <!-- ÏùºÎ∞òÎ¶¨Ïä§Ìä∏Î°ú ÎèåÏïÑÍ∞ÄÍ∏∞ --> 
                    
                    	<button onclick="location.href='<%=contextPath%>/list.free?currentPage=<%=currentPage %>&sorting=<%=sorting%>'" class="btn btn-secondary">Î™©Î°ù</button>
                    	
                    <%}else{ %> <!-- Í≤ÄÏÉâÏãú Î¶¨Ïä§Ìä∏Î°ú ÎèåÏïÑÍ∞ÄÍ∏∞ -->
                    
	                    <button onclick="location.href='<%=contextPath%>/listSearch.free?currentPage=<%=currentPage%>&sorting=<%=sorting%>&inputValue=<%=inputValue%>&searchOption=<%=searchOption%>'">Î™©Î°ù</button>
	                    			
                    <%} %>
                </div>
            </div>
                
            
        </div>
    </div>
    
    
    
    
	<script>
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////	
	/* Ï¢ãÏïÑÏöî Í¥ÄÎ†® */
	
	
	$(function(){ /* ÌôîÎ©¥Ïù¥ Îã§ ÍπîÎ¶¨Í≥† Ïã§Ìñâ */
		
		/* Ï¢ãÏïÑÏöî Ïàò , ÎÇ¥Í∞Ä ÎàåÎ†ÄÎäîÏßÄ ÏïàÎàåÎ†ÄÎäîÏßÄ ÌôïÏù∏ */
	
		//console.log("Ïã§ÌñâÎê®1");
		
		selectLike(); /* Ï¢ãÏïÑÏöî ÏïÑÏù¥ÏΩò  */
		selectLikeCount();   /* Ï¢ãÏïÑÏöî Ïàò */ 
		
	});
	
	
	
	/* Ï¢ãÏïÑÏöî ÎàåÎ†ÄÎäîÏßÄ Ï°∞Ìöå */
	function selectLike(){
		
		

			
		let freeNo = <%=f.getFreeNo()%>;  /* Í≤åÏãúÍ∏ÄÎ≤àÌò∏ */

		/* 
			&#x2764;&#xFE0F;  Îπ®Í∞ÑÌïòÌä∏
			&#x1F90D;		  Ìù∞ÌïòÌä∏
		*/
		$.ajax({
			url:"<%=contextPath%>/selectLike.free", 
			type:"post",
			data:{
				freeNo:freeNo,
			},
			success:function(result){
				
				
				if(result>0){  /* Ï¢ãÏïÑÏöî ÌÖåÏù¥Î∏î - Í≤åÏãúÍ∏ÄÎ≤àÌò∏, ÎÇ¥Ïú†Ï†ÄÎ≤àÌò∏  */
					/* ÏïÑÏù¥ÏΩòÏÉâÍπî Îπ®Í∞õÍ≤å, ÌÅ¥Î¶≠Í∞ÄÎä• ÏÇ≠Ï†úÎ©îÏÜåÎìú */		
					
				/*	$("#like-icon").html("&#x2764;&#xFE0F;");
					$("#like-icon").off("click");  //ÌÅ¥Î¶≠ÏÜçÏÑ±Ïù¥ Ï§ëÏ≤©ÎêòÍ∏∞ÎïåÎ¨∏Ïóê Ï†úÍ±∞ÌïÑÏöî 
					$("#like-icon").click(()=>deleteLike(freeNo));
				*/	
					$("#like-icon").off("click").html("&#x2764;&#xFE0F;").click(()=>deleteLike(freeNo));
					
					
				}else{
					/*ÏïÑÏù¥ÏΩò ÏÉâÍπî ÌïòÏñóÍ≤å, ÌÅ¥Î¶≠Í∞ÄÎä• ÏûÖÎ†•Î©îÏÜåÎìú*/
				/*	$("#like-icon").html("&#x1F90D;");
					$("#like-icon").off("click"); 
					$("#like-icon").click(()=>insertLike(freeNo));
				*/	
					$("#like-icon").off("click").html("&#x1F90D;").click(()=>insertLike(freeNo));
					
				}
				
			},
			error:function(){
				console.log("ajaxÌÜµÏã† Ïã§Ìå® : Ï¢ãÏïÑÏöî ÏïÑÏù¥ÏΩò Ï°∞Ìöå")
			}
		});
		
		
	};
	
	/* Ï¢ãÏïÑÏöî ÏÑ§Ï†ï */
	function insertLike(freeNo){
		//console.log("Ï¢ãÏïÑÏöî ÏÑ§Ï†ï");
		
		$.ajax({
			url:"<%=contextPath%>/insertLike.free",
			type:"get",
			data:{freeNo:freeNo},
			success:function(){
				console.log("ajax Ï¢ãÏïÑÏöîÏÑ§Ï†ï ÏÑ±Í≥µ");
				selectLike();
				selectLikeCount();
			},
			error:function(){
				console.log("ajax Ï¢ãÏïÑÏöîÏÑ§Ï†ï Ïã§Ìå®");
			}
		})
		
		/* selectLike(); ÎπÑÎèôÍ∏∞Ï†ÅÏúºÎ°ú Ïã§ÌñâÎêòÍ∏∞ÎïåÎ¨∏Ïóê ajax Íµ¨Î¨∏Î≥¥Îã§ Î®ºÏ†Ä Ïã§ÌñâÎê†Ïàò ÏûàÏùå*/
		
	};
	
	/* Ï¢ãÏïÑÏöî Ìï¥Ï†ú */
	function deleteLike(freeNo){
		//console.log("Ï¢ãÏïÑÏöî Ìï¥Ïû¨");
		
		$.ajax({
			url:"<%=contextPath%>/deleteLike.free",
			type:"get",
			data:{freeNo:freeNo},
			success:function(){
				console.log("ajax Ï¢ãÏïÑÏöîÌï¥Ï†ú ÏÑ±Í≥µ");
				selectLike();
				selectLikeCount();
			},
			error:function(){
				console.log("ajax Ï¢ãÏïÑÏöîÌï¥Ï†ú Ïã§Ìå®");
			}
		})
		
		
	};
	
	
	/* Ï¢ãÏïÑÏöî Ïàò */
	function selectLikeCount(){
		
		let freeNo = <%=f.getFreeNo()%>;
		
		$.ajax({
			url:"<%=contextPath%>/selectLikeCount.free",
			type:"get",
			data:{freeNo:freeNo},
			success:function(likeCount){
				
				$("#like-count").html(likeCount);
				console.log("ajax Ï¢ãÏïÑÏöîÏàò Ï°∞Ìöå ÏÑ±Í≥µ");
			},
			error:function(){
				console.log("ajax Ï¢ãÏïÑÏöîÏàò Ï°∞Ìöå Ïã§Ìå®");
			}
		});
	}
	
	

	
		/* ÎåìÍ∏ÄÍ¥ÄÎ†® */
		let setIntervalComment; //setInterval Ï†ÑÏó≠Î≥ÄÏàòÎ°ú ÏÑ§Ï†ï(Ï¢ÖÎ£åÌñàÎã§ Îã§Ïãú Ïã§ÌñâÌïòÍ∏∞ ÏúÑÌï¥)
		
	 	$(function(){ //ÌéòÏù¥ÏßÄÍ∞Ä Î°úÎìúÎê†Îïå ÎåìÍ∏ÄÎ¶¨Ïä§Ìä∏ + ÎåìÍ∏Ä Ïã§ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏
			selectCommentList();
			setIntervalComment = setInterval(selectCommentList,1000);  //
		})  
	
	
		
		
		
		/* ÎåìÍ∏ÄÏûëÏÑ± ajax  */
		function inserComment(){
			
			
			let comment = $("#free-comment").val();
			let freeNo = <%=f.getFreeNo()%>;
			
			
			$.ajax({
				
				url:"<%=contextPath%>/commentInsert.free",
				type:"post",
				data:{
					freeNo : freeNo,
					comment : comment
	
				},
				success:function(result){
					if(result>0){
						selectCommentList(); 
						//console.log("ÎåìÍ∏Ä Ïù∏ÏÑúÌä∏ Îê®") /* Îê® */
						$("#free-comment").val("");
					}else{
						alert("ÎåìÍ∏ÄÏûëÏÑ±Ïö© ajax ÌÜµÏã† Ïã§Ìå®!!");
						$("#free-comment").val("");
					}
				},
				/* error : function(){} */
			});
			
		}
	
		
		
	 // ÎåìÍ∏ÄÎ¶¨Ïä§Ìä∏ Ï°∞ÌöåÏö© ajax
		function selectCommentList() {
			
		    $.ajax({
		        url: "<%=contextPath%>/commentList.free",
		        type: "get",
		        data: { freeNo: <%=f.getFreeNo()%> },
		        success: function(result) {
		            let resultStr = "";
		            const loginUserNo = <%=(loginUser != null) ? loginUser.getUserNo() : -1%>;
		           
		            for (let i in result) {
		               
		                resultStr += "<tr>"
		                           + "<td><b>" + result[i].userNickName + "</b></td>"
		                           + "<td class='commentContent'>" + result[i].freeCommContent + "</td>"
		                          
		               
		                if (loginUserNo == result[i].userNo) {
		                    resultStr += "<td>"+
		                    			 "<button class='update-comment btn btn-sm ' freeCommNo='"+result[i].freeCommNo+"'>ÏàòÏ†ï</button>"+
		                    			 "<button class='delete-comment btn btn-sm ' freeCommNo='"+result[i].freeCommNo+"'>ÏÇ≠Ï†ú</button>"+
		                    			 "</td>";
		                }else{ resultStr += "<td></td>";}
			
						resultStr += "<td>" + result[i].freeCommDate + "</td>";
		                          
		                resultStr += "</tr>";
		            }
		            $(".comment-table").html(resultStr);
		           
		            $("#comment-count").html(result.length);
		           
		           
		        },
		        error: function() {
		            console.log("ÎåìÍ∏ÄÎ¶¨Ïä§Ìä∏Ï°∞ÌöåÏö© ajax ÌÜµÏã†Ïã§Ìå®!!");
		        }
		    });
		    
		    
            
        	
        
        
        
		}
		
		
		
		
		
		  
		
		//ÎåìÍ∏Ä ÏàòÏ†ï Î≤ÑÌäº ÌÅ¥Î¶≠Ïãú AJAX 
		$(document).on('click', '.update-comment', function() { //ÎåìÍ∏Ä ÏàòÏ†ïÎ≤ÑÌäº ÌÅ¥Î¶≠Ïãú

		    //Ïù¥Ï†ÑÏóê ÎùÑÏö¥ ÎåìÍ∏ÄÏàòÏ†ïÏ∞Ω ÏÇ≠Ï†úÍµ¨Î¨∏ ÌïÑÏöî
		    $(".insert-comment").closest("tr").remove();

		    // setInterval Ïû†Ïãú Ï¢ÖÎ£å (ÎÅùÎÇòÎ©¥ Îã§Ïãú Ïã§Ìñâ)
		    if (setIntervalComment) {
		        clearInterval(setIntervalComment);
		    }

		    let freeCommNo = $(this).attr("freeCommNo"); //ÏàòÏ†ïÌï† ÎåìÍ∏Ä Î≤àÌò∏ ÎΩëÏïÑÎÇ¥Í∏∞

		    let updateForm = `
		        <tr>
		            <td colspan='4'>
		                <div class="insert-comment">
		                    <div class="coment-writer"><b><%if(loginUser!=null){%><%=loginUser.getUserNickname()%><%}else{%>Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.<%}%></b></div>
		                    <div class="comment-content">
		                        <textarea name="freeComment" id="free-comment1" class="comment-content-area" style="resize: none" maxLength="1000" oninput="updateCharCount(this)"></textarea>
		                    </div>
		                    <div class="comment-bottom">
		                        <div class="comment-button">
		                            <button  onClick="updateComment(this)" class="btn btn-info btn-sm">Îì±Î°ù</button>
		                            <button  onClick="selectCommentList()" class="btn btn-secondary btn-sm">Ï∑®ÏÜå</button>
		                        </div>
		                        <div id="charCount1">0/1000</div>
		                    </div>
		                </div>
		            </td>
		        </tr>`;

		    $(this).closest("tr").after(updateForm); // ÎåìÍ∏ÄÏàòÏ†ï ÌÅ¥Î¶≠Ïãú ÏûÖÎ†•Ï∞Ω ÎùÑÏñ¥Ï£ºÍ∏∞
		    selectComment(freeCommNo, this); //Í∏∞Ï°¥Ïùò ÎåìÍ∏Ä ÎÇ¥Ïö© Ï°∞ÌöåÌï¥ÏÑú, textArea Ïóê ÎÑ£Ïñ¥Ï£ºÍ∏∞ 
		});

		// ÎåìÍ∏Ä ÏàòÏ†ï Ï∞Ω Í∏ÄÏûê Ïàò ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò
		function updateCharCount(textarea) {
		    const charCount = document.getElementById("charCount1");
		    const currentLength = textarea.value.length;
		    const maxLength = textarea.getAttribute("maxlength");
		    
		    charCount.innerHTML = currentLength + "/" + maxLength;
		}
		
		
		
	 	function updateComment(element){ //ÎåìÍ∏Ä ÏóÖÎç∞Ïù¥Ìä∏
				
			let commentContent =  $(element).closest("tr").find(".comment-content-area").val();		
			let commentNo =  $(element).closest("tr").find(".comment-content-area").attr("freeCommNo");
			//let commUserNo = $(element).closest("tr").find(".comment-content-area").attr("userNo"); 
			
	 		//console.log(commentContent);
	 		//console.log(commentNo);	
	 		//console.log(commentUserNo);
	 		
	 		
			
			$.ajax({url:"<%=contextPath%>/updateComment.free",
					type:"post",
					data:{
						freeCommentContent:commentContent,
						freeCommentNo:commentNo,
						//userNo:commUserNo
					},
					success:function(result){
						if(result>0){
							alert("ÎåìÍ∏ÄÏù¥ ÏàòÏ†ïÎêêÏäµÎãàÎã§.");
							selectCommentList();
							setInterval(selectCommentList,1000);
						}else{
							alert("ÎåìÍ∏ÄÏàòÏ†ïÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.");
						}
						
					},
					error:function(){
						console.log("ajax ÎåìÍ∏ÄÏàòÏ†ï Ïó∞Í≤∞ Ïã§Ìå®");
					}
			})
			 
			
		}; 
		 
		
		  
		 
		 
		function selectComment(freeCommNo,element){//ÎåìÍ∏Ä ÌïúÍ∞ú Ï°∞Ìöå-> ÏàòÏ†ïÏ∞ΩÏóê ÎåìÍ∏Ä ÎÇ¥Ïö© ÎùÑÏñ¥Ï£ºÍ∏∞
		
			$.ajax({url:"<%=contextPath%>/selectComment.free",
					type:"post",
					data:{freeCommNo:freeCommNo},
					success:function(result){
						
	
						
						$(element).closest("tr").next().find(".comment-content-area").val(result.freeCommContent);
						//Î≤ÑÌäº ÏöîÏÜåÏùò Í∞ÄÏû• Í∞ÄÍπåÏö¥ trÏöîÏÜåÏùò Îã§Ïùå trÏ§ëÏóêÏÑú .comment-contentÏù∏ ÎÜàÏùÑ Ï∞æÏïÑÎùº
						$(element).closest("tr").next().find(".comment-content-area").attr("freeCommNo",result.freeCommNo);
						$(element).closest("tr").next().find(".comment-content-area").attr("userNo",result.userNo);
						
						
					},
					error:function(){
						console.log("ajax ÎåìÍ∏ÄÌïúÍ∞úÏ°∞Ìöå Ïã§Ìå®")
					}
			})
		}
		
	
		 
		// ÎåìÍ∏Ä ÏÇ≠Ï†ú ajax 
		
		$(document).on('click', '.delete-comment',function(){
			
			let freeCommNo = $(this).attr("freeCommNo");
			//console.log(freeCommNo); 
			
			if(confirm("ÎåìÍ∏ÄÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?")){
				$.ajax({
					
					url : "<%=contextPath%>/deleteComment.free",
					type:"get",
					data:{freeCommNo:freeCommNo},
					success: function(){
						selectCommentList();
						alert("ÎåìÍ∏ÄÏù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.")
						
					},
					error:function(){
						console.log("ajax ÎåìÍ∏ÄÏÇ≠Ï†ú Ïã§Ìå®");
					}
				})
			}
								
		});
		/* ÎåìÍ∏ÄÍ¥ÄÎ†® */
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    	 <!-- Í≤åÏãúÍ∏Ä Í¥ÄÎ†® -->
    
    
		function remove(){ //Í≤åÏãúÍ∏Ä ÏÇ≠Ï†ú Î≤ÑÌäº ÌÅ¥Î¶≠Ïãú 
			if(confirm("ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?")){
				location.href="<%=contextPath%>/delete.free?freeNo=<%=f.getFreeNo()%>&userNo=<%=f.getUserNo()%>";
			}
		}
		function updateForm(){ // Í≤åÏãúÍ∏Ä ÏàòÏ†ï Î≤ÑÌäº ÌÅ¥Î¶≠Ïä§
			if(confirm("ÏàòÏ†ïÌïòÏãúÍ≤†ÏäµÎãàÍπå?")){
				location.href="<%=contextPath%>/updateForm.free?freeNo=<%=f.getFreeNo()%>&userNo=<%=f.getUserNo()%>";
			}																							
		}    
		<!-- Í≤åÏä§Í∏Ä Í¥ÄÎ†® -->
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    </script> 
    
    <%@ include file="../common/footer.jsp"%>  <!-- Î∞îÎ≥¥Íµ¨Í∞Ñ --> 
        
        
    </body>
</html>